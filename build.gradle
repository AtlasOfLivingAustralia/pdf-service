buildscript {
    ext {
        kotlinVersion = '0.12.1230'
    }
    repositories {
        jcenter()
        mavenLocal()
        mavenCentral()
    }
    dependencies {
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlinVersion"
        classpath 'com.github.jengelman.gradle.plugins:shadow:1.2.2'
    }
}

allprojects {
    apply plugin: 'java'
    apply plugin: 'kotlin'
    ext {
        dropwizardVersion = '0.8.2'
    }
    group = 'au.org.ala'
    version = '1.0-SNAPSHOT'
    sourceCompatibility = 1.7

    repositories {
        jcenter()
        mavenLocal()
        mavenCentral()
//        maven {
//            url "http://52north.org/maven/repo/releases"
//        }
    }

    dependencies {
        compile "org.jetbrains.kotlin:kotlin-stdlib:$kotlinVersion"
    }
  
}

project(':pdfgen-api') {
    dependencies {
        compile('com.fasterxml.jackson.module:jackson-module-kotlin:2.5.3.1')
    }
}

project(':pdfgen-application') {
    dependencies {
        compile project(':pdfgen-api')
        compile "io.dropwizard:dropwizard-core:$dropwizardVersion"
//        compile "io.dropwizard:dropwizard-jdbi:$dropwizardVersion"
        compile "io.dropwizard:dropwizard-client:$dropwizardVersion"
//        compile "io.dropwizard.modules:dropwizard-java8:0.8.0-2"
//        compile "io.dropwizard.modules:dropwizard-java8-jdbi:0.8.0-2"
//        compile "io.dropwizard.modules:dropwizard-flyway:0.8.0-2"
//        compile('com.fasterxml.jackson.module:jackson-module-kotlin:2.5.3.1') {
//            exclude group: 'com.fasterxml.jackson.core'
//        }
//        compile 'org.postgresql:postgresql:9.4-1201-jdbc41'
//        compile 'org.postgis:postgis-jdbc:2.1.3'
    }
}


apply plugin: 'application'
apply plugin: 'com.github.johnrengelman.shadow'

mainClassName = 'au.org.ala.PdfGen'

def devconfig = 'devconfig.yml'

run { args 'server', devconfig }

-dependencies {
    compile project(':pdfgen-application')
}

shadowJar {
    exclude 'LICENSE'
    exclude 'META-INF/*.SF'
    exclude 'META-INF/*.DSA'
    exclude 'META-INF/*.RSA'
    mergeServiceFiles()
}
